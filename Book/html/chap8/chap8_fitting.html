<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8. Curve Fitting &mdash; PyMan 0.9.30 documentation</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.30',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="PyMan 0.9.30 documentation" href="../index.html" />
    <link rel="next" title="9. Numerical Routines: SciPy and NumPy" href="../chap9/chap9_scipy.html" />
    <link rel="prev" title="7. Functions" href="../chap7/chap7_funcs.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../pymanMaster.html">PyMan 0.9.30 documentation</a></div>
        <div class="rel">
          <a href="../chap7/chap7_funcs.html" title="7. Functions"
             accesskey="P">previous</a> |
          <a href="../chap9/chap9_scipy.html" title="9. Numerical Routines: SciPy and NumPy"
             accesskey="N">next</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="curve-fitting">
<span id="chap8"></span><span id="index-0"></span><h1>8. Curve Fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this headline">¶</a></h1>
<p>One of the most important tasks in any experimental science is modeling data and determining how well some theoretical function describes experimental data.  In the last chapter, we illustrated how this can be done when the theoretical function is a simple straight line in the context of learning about Python functions and methods.  Here we show how this can be done for a arbitrary fitting functions, including linear, exponential, power law, and other nonlinear fitting functions.</p>
<div class="section" id="using-linear-regression-for-fitting-non-linear-functions">
<h2>8.1. Using linear regression for fitting non-linear functions<a class="headerlink" href="#using-linear-regression-for-fitting-non-linear-functions" title="Permalink to this headline">¶</a></h2>
<p>We can use our results for linear regression with <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/> weighting that we developed in Chapter 7 to fit functions that are nonlinear in the fitting parameters, <em>provided</em> we can transform the fitting function into one that is linear in the fitting parameters and in the independent variable (<img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/>).</p>
<div class="section" id="linear-regression-for-fitting-an-exponential-function">
<span id="index-1"></span><h3>8.1.1. Linear regression for fitting an exponential function<a class="headerlink" href="#linear-regression-for-fitting-an-exponential-function" title="Permalink to this headline">¶</a></h3>
<p>To illustrate this approach, let&#8217;s consider some experimental data taken from a radioactive source that was emitting beta particles (electrons).  We notice that the number of electrons emitted per unit time is decreasing with time.  Theory suggests that the number of electrons <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> emitted per unit time should decay exponentially according to the equation</p>
<div class="math" id="equation-eq:decay">
<p><span class="eqno">(1)</span><img src="../_images/math/01200af87fb3c3c80e89c4bebe3128699519222b.png" alt="N(t) = N_0 e^{-t/\tau} \;."/></p>
</div><p>This equation is nonlinear in <img class="math" src="../_images/math/ef9270877405055756d345facd044e4ab297f858.png" alt="t"/> and in the fitting parameter <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/> and thus cannot be fit using the method of the previous chapter.  Fortunately, this is a special case for which the fitting function can be transformed into a linear form.  Doing so will allow us to use the fitting routine we developed for fitting linear functions.</p>
<p>We begin our analysis by transforming our fitting function to a linear form.  To this end we take the logarithm of Eq. <a href="#equation-eq:decay">(1)</a>:</p>
<div class="math">
<p><img src="../_images/math/84479a3c17de19666d366b8636a38a1a4751d081.png" alt="\ln N = \ln N_{0} -\frac{t}{\tau} \;."/></p>
</div><p>With this tranformation our fitting function is linear in the independent variable <img class="math" src="../_images/math/ef9270877405055756d345facd044e4ab297f858.png" alt="t"/>.  To make our method work, however, our fitting function must be linear in the <em>fitting parameters</em>, and our transformed function is still nonlinear in the fitting parameters <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/> and <img class="math" src="../_images/math/696944b27d295d99143752d7d3e9c03ed42f5224.png" alt="N_0"/>.  Therefore, we define new fitting parameters as follows</p>
<div class="math" id="equation-eq:eq15">
<p><span class="eqno">(2)</span><img src="../_images/math/4f9defd0ed2fa466464ed4d35927c117d7332deb.png" alt="a &amp;= \ln N_{0}\\
b &amp;= -1/\tau"/></p>
</div><p>Now if we define a new dependent variable <img class="math" src="../_images/math/a8c3284518a5ea25ed62c6f12f62ba846441a855.png" alt="y = \ln N"/>, then our fitting function takes the form of a fitting function that is linear in the fitting parameters <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/></p>
<div class="math">
<p><img src="../_images/math/916df25c35c123e1450686181d17b4b25b0be30a.png" alt="y = a + bx"/></p>
</div><p>where the independent variable is <img class="math" src="../_images/math/d5114b2a67b6cc15a36c68047e69f7395caeffb6.png" alt="x=t"/> and the dependent variable is <img class="math" src="../_images/math/939a3e3ab5cd3bb1f718dbcfab2f6876d4acddcd.png" alt="y=\ln N"/>.</p>
<p>We are almost ready to fit our transformed fitting function, with transformed fitting parameters <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, to our transformed independent and dependent data, <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> and <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/>.  The last thing we have to do is to transform the estimates of the uncertainties <img class="math" src="../_images/math/8b48e39be16d0b09401f34d8459288c41d235031.png" alt="\delta N"/> in <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> to the uncertainties <img class="math" src="../_images/math/a39414e3158dd15c38b892f25f15b13c3957b2cb.png" alt="\delta y"/> in <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> <img class="math" src="../_images/math/856dcea98478b5f4c8e28bcdf218b6bc266f33e2.png" alt="(= \ln N)"/>.  So how much does a given uncertainty in <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> translate into an uncertainty in <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/>?  In most cases, the uncertainty in <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> is much smaller than <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/>, <em>i.e.</em> <img class="math" src="../_images/math/ac41c11e43703f645a6654d9b478aac5077dbd9b.png" alt="\delta y \ll y"/>; similarly <img class="math" src="../_images/math/5c9fb167801ab4f49f0847c1e93b3d8525fb1365.png" alt="\delta N \ll N"/>.  In this limit we can use differentials to figure out the relationship between these uncertainties.  Here is how it works for this example:</p>
<div class="math" id="equation-eq:sigmaLnN">
<p><span class="eqno">(3)</span><img src="../_images/math/f18fa2b42419aaec82d3df850a06095475549ea3.png" alt="y &amp;= \ln N\\
\delta y &amp;= \left|\frac{\partial y}{\partial N}\right|\delta N\\
\delta y &amp;= \frac{\delta N} {N} \;."/></p>
</div><p>Equation <a href="#equation-eq:sigmaLnN">(3)</a> tells us how a small change <img class="math" src="../_images/math/8b48e39be16d0b09401f34d8459288c41d235031.png" alt="\delta N"/> in <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> produces a small change <img class="math" src="../_images/math/a39414e3158dd15c38b892f25f15b13c3957b2cb.png" alt="\delta y"/> in <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/>.  Here we identify the differentials <img class="math" src="../_images/math/c940063f2960c92469cf37fad9a79b852cccb612.png" alt="dy"/> and <img class="math" src="../_images/math/9ddb262875b86fbfd369a723fa284694ffc1192c.png" alt="dN"/> with the uncertainties <img class="math" src="../_images/math/a39414e3158dd15c38b892f25f15b13c3957b2cb.png" alt="\delta y"/> and <img class="math" src="../_images/math/8b48e39be16d0b09401f34d8459288c41d235031.png" alt="\delta N"/>.  Therefore, an uncertainty of <img class="math" src="../_images/math/8b48e39be16d0b09401f34d8459288c41d235031.png" alt="\delta N"/> in <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> corresponds, or translates, to an uncertainty <img class="math" src="../_images/math/a39414e3158dd15c38b892f25f15b13c3957b2cb.png" alt="\delta y"/> in <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/>.</p>
<p>Let&#8217;s summarize what we have done so far.  We started with the some data points <img class="math" src="../_images/math/4f185ca06aad7d3faebbb99ded35a1fd9c75f570.png" alt="\{t_i,N_i\}"/> and some addition data <img class="math" src="../_images/math/67ebfbf350b72f4c4f5c0ff467360c5b8bc6e1d4.png" alt="\{\delta N_i\}"/> where each datum <img class="math" src="../_images/math/7117ce279b0c3475dcfa58c8724cc0abae870dbe.png" alt="\delta N_i"/> corresponds to the uncertainty in the experimentally measured <img class="math" src="../_images/math/d1929c9e1002e67a2164c6440efbe0ad4e42073e.png" alt="N_i"/>.  We wish to fit these data to the fitting function</p>
<div class="math">
<p><img src="../_images/math/01200af87fb3c3c80e89c4bebe3128699519222b.png" alt="N(t) = N_0 e^{-t/\tau} \;."/></p>
</div><p>We then take the natural logarithm of both sides and obtain the linear equation</p>
<div class="math" id="equation-eq:TransformedSemilog">
<p><span class="eqno">(4)</span><img src="../_images/math/0aa40bf4aa516f97880a440911a134a76ff676bb.png" alt="\ln N &amp;= \ln N_{0} -\frac{t}{\tau} \\
y &amp;= a + bx"/></p>
</div><p>with the obvious correspondences</p>
<div class="math" id="equation-eq:eqlist">
<p><span class="eqno">(5)</span><img src="../_images/math/ebd8cd3c1d2a2396d1883159e3ece766cca88c15.png" alt="x &amp;= t\\
y &amp;= \ln N\\
a &amp;= \ln N_{0}\\
b &amp;= -1/\tau"/></p>
</div><p>Now we can use the linear regression routine with <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/> weighting that we developed in the previous section to fit  <a href="#equation-eq:TransformedSemilog">(4)</a> to the transformed data <img class="math" src="../_images/math/ee4c327808555092091718bf3565a69f769aecab.png" alt="x_i (= t_i)"/> and  <img class="math" src="../_images/math/cea32c7610e56817deccbf0f0c79f5426249913c.png" alt="y_i (= \ln N_i)"/>.  The inputs are the tranformed data <img class="math" src="../_images/math/664fbf001b6306900494a796c70c0f37df4cd3e6.png" alt="{x_i}, {y_i}, {\delta y_i}"/>.  The outputs are the fitting parameters <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, as well as the estimates of their uncertainties <img class="math" src="../_images/math/1b3ed4ad3d210774124dd14b5ca3dd3da4a68531.png" alt="\delta a"/> and <img class="math" src="../_images/math/98e3c52e416f0db327c2fa5f76fe165807d7b657.png" alt="\delta b"/> along with the value of <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/>.  You can obtain the values of the original fitting parameters <img class="math" src="../_images/math/696944b27d295d99143752d7d3e9c03ed42f5224.png" alt="N_0"/> and <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/> by taking the differentials of the last two equations in Eq. <a href="#equation-eq:eqlist">(5)</a>:</p>
<div class="math" id="equation-eq:paramunc">
<p><span class="eqno">(6)</span><img src="../_images/math/3e89c6561c1a613c910274f3418880e42a68710e.png" alt="\delta a &amp;= \left|\frac{\partial a}{\partial N_0}\right|\delta N_0
          = \frac{\delta N_{0}}{N_{0}}\\
\delta b &amp;= \left|\frac{\partial b}{\partial \tau}\right|\delta \tau
          = \frac{\delta \tau}{\tau^2}"/></p>
</div><p>The Python routine below shows how to implement all of this for a set of experimental data that is read in from a data file.</p>
<p>Figure <a class="reference internal" href="#fig-betadecay"><em>8.1</em></a> shows the output of the fit to simulated beta decay data obtained using the program below.  Note that the error bars are large when the number of counts <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> are small.  This is consistent with what is known as <em>shot noise</em> (noise that arises from counting discrete events), which obeys <em>Poisson</em> statistics.  You will study sources of noise, including shot noise, later in your lab courses.  The program also prints out the fitting parameters of the transformed data as well as the fitting parameters for the exponential fitting function.</p>
<div class="figure align-center" id="fig-betadecay">
<a class="reference internal image-reference" href="../_images/betaDecay.png"><img alt="Semi-log plot of beta decay measurements from Phosphorus-32." src="../_images/betaDecay.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption">Semi-log plot of beta decay measurements from Phosphorus-32.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">LineFitWt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit to straight line.</span>
<span class="sd">    Inputs: x and y arrays and uncertainty array (unc) for y data.</span>
<span class="sd">    Ouputs: slope and y-intercept of best fit to data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sig2</span> <span class="o">=</span> <span class="n">sig</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">xhat</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">yhat</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">xhat</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">xhat</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">yint</span> <span class="o">=</span> <span class="n">yhat</span> <span class="o">-</span> <span class="n">slope</span><span class="o">*</span><span class="n">xhat</span>
    <span class="n">sig2_slope</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">xhat</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">sig2_yint</span> <span class="o">=</span> <span class="n">sig2_slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">norm</span>
    <span class="k">return</span> <span class="n">slope</span><span class="p">,</span> <span class="n">yint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig2_slope</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig2_yint</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">redchisq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">yint</span><span class="p">):</span>
    <span class="n">chisq</span> <span class="o">=</span> <span class="p">(((</span><span class="n">y</span><span class="o">-</span><span class="n">yint</span><span class="o">-</span><span class="n">slope</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">chisq</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># Read data from data file</span>
<span class="n">t</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&quot;betaDecay.txt&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c">########## Code to tranform &amp; fit data starts here ##########</span>

<span class="c"># Transform data and parameters to linear form: Y = A + B*X</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">t</span>         <span class="c"># transform t data for fitting (trivial)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c"># transform N data for fitting</span>
<span class="n">dY</span> <span class="o">=</span> <span class="n">dN</span><span class="o">/</span><span class="n">N</span>     <span class="c"># transform uncertainties for fitting</span>

<span class="c"># Fit transformed data X, Y, dY to obtain fitting parameters A &amp; B</span>
<span class="c"># Also returns uncertainties in A and B</span>
<span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">dB</span><span class="p">,</span> <span class="n">dA</span> <span class="o">=</span> <span class="n">LineFitWt</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">dY</span><span class="p">)</span>
<span class="c"># Return reduced chi-squared</span>
<span class="n">redchisqr</span> <span class="o">=</span> <span class="n">redchisq</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">dY</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="c"># Determine fitting parameters for original exponential function</span>
<span class="c"># N = N0 exp(-t/tau) ...</span>
<span class="n">N0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">tau</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">B</span>
<span class="c"># ... and their uncertainties</span>
<span class="n">dN0</span> <span class="o">=</span> <span class="n">N0</span> <span class="o">*</span> <span class="n">dA</span>
<span class="n">dtau</span> <span class="o">=</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dB</span>

<span class="c">####### Code to plot transformed data and fit starts here #######</span>

<span class="c"># Create line corresponding to fit using fitting parameters</span>
<span class="c"># Only two points are needed to specify a straight line</span>
<span class="n">Xext</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">Xfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">Xext</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">Xext</span><span class="p">])</span>
<span class="n">Yfit</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="o">*</span><span class="n">Xfit</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">dY</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xfit</span><span class="p">,</span> <span class="n">Yfit</span><span class="p">,</span> <span class="s">&quot;r-&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;$\mathrm{Fit</span><span class="se">\\</span><span class="s"> to:}</span><span class="se">\\</span><span class="s"> \ln N = -t/</span><span class="se">\\</span><span class="s">tau + \ln N_0$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;ln(N)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="s">&quot;A = ln N0 = {0:0.2f} $\pm$ {1:0.2f}&quot;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">dA</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">,</span> <span class="s">&quot;B = -1/tau = {0:0.4f} $\pm$ {1:0.4f}&quot;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="n">B</span><span class="p">,</span> <span class="n">dB</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="s">&quot;$\chi_r^2$ = {0:0.3f}&quot;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">redchisqr</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="s">&quot;N0 = {0:0.0f} $\pm$ {1:0.0f}&quot;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N0</span><span class="p">,</span> <span class="n">dN0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">,</span> <span class="s">&quot;tau = {0:0.1f} $\pm$ {1:0.1f} days&quot;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">dtau</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<span class="target" id="index-2"></span></div>
<div class="section" id="linear-regression-for-fitting-a-power-law-function">
<span id="index-3"></span><h3>8.1.2. Linear regression for fitting a power-law function<a class="headerlink" href="#linear-regression-for-fitting-a-power-law-function" title="Permalink to this headline">¶</a></h3>
<p>You can use a similar approach to the one outlined above to fit experimental data to a power law fitting function of the form</p>
<div class="math" id="equation-eq:pwrlaw">
<p><span class="eqno">(7)</span><img src="../_images/math/5e704faeb6824ff7ee7a5aca747fd5cce8594f6c.png" alt="P(s) = P_0 s^\alpha \;."/></p>
</div><p>We follow the same approach we used for the exponential fitting function and first take the logarithm of both sides of <a href="#equation-eq:pwrlaw">(7)</a></p>
<div class="math" id="equation-eq:logpwrlaw">
<p><span class="eqno">(8)</span><img src="../_images/math/825237e219f635114d24bf01ee6e4245412c8177.png" alt="\ln P = \ln P_0 + \alpha \ln s \;."/></p>
</div><p>We recast this in the form of a linear equation <img class="math" src="../_images/math/c7ac4a56a69d067a93b1c2c6a4646cc2bee027f2.png" alt="y = a + bx"/> with the following identifications:</p>
<div class="math" id="equation-eq:eqPwrTrans">
<p><span class="eqno">(9)</span><img src="../_images/math/2719ff9c3a762e58aa6d636b401de1b9230651ce.png" alt="x &amp;= \ln s\\
y &amp;= \ln P\\
a &amp;= \ln P_{0}\\
b &amp;= \alpha"/></p>
</div><p>Following a procedure similar to that used to fit using an exponential fitting function, you can use the tranformations given by <a href="#equation-eq:eqPwrTrans">(9)</a> as the basis for a program to fit a power-law fitting function such as <a href="#equation-eq:logpwrlaw">(8)</a> to experimental data.</p>
</div>
</div>
<div class="section" id="nonlinear-fitting">
<span id="sec-nonlinfit"></span><span id="index-4"></span><h2>8.2. Nonlinear fitting<a class="headerlink" href="#nonlinear-fitting" title="Permalink to this headline">¶</a></h2>
<p>The method introduced in the previous section for fitting nonlinear fitting functions can be used only if the fitting function can be transformed into a fitting function that is linear in the fitting parameters  <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/>, <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, <img class="math" src="../_images/math/65868d23a5bfe5b3b2d819386b19c14fa36af134.png" alt="c"/>...  When we have a nonlinear fitting function that cannot be transformed into a linear form, we need another approach.</p>
<p>The problem of finding values of the fitting parameters that minimize <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/> is a nonlinear optimization problem to which there is quite generally no analytical solution (in contrast to the linear optimization problem).  We can gain some insight into this nonlinear optimization problem, namely the fitting of a nonlinear fitting function to a data set, by considering a fitting function with only two fitting parameters.  That is, we are trying to fit some data set <img class="math" src="../_images/math/d06b1cbfab7dfc0cbbbd337df6bef341326a328a.png" alt="\{x_{i},y_{i}\}"/>, with uncertainties in <img class="math" src="../_images/math/8d609fbf3f5c4824f8420e386e6337a84f591571.png" alt="\{y_{i}\}"/> of <img class="math" src="../_images/math/51104887a06dbbd7a10d79ee5083f3557e7dbbc8.png" alt="\{\sigma_{i}\}"/>, to a fitting function is <img class="math" src="../_images/math/54928e357f9de50e79641c5cabb58ac3a5abea86.png" alt="f(x;a,b)"/> where <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> are the two fitting parameters.  To do so, we look for the minimum in</p>
<div class="math">
<p><img src="../_images/math/daedf6090e76774b05e8c3b0caedbbd45f9f5fc4.png" alt="\chi^2(a,b) = \sum_{i} \left(\frac{y_{i} - f(x_{i})}{\sigma_{i}}\right)^2 \;."/></p>
</div><p>Note that once the data set, uncertainties, and fitting function are specified,  <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/> is simply a function of <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>.  We can picture the function <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/> as a of landscape with peaks and valleys: as we vary <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/> rises and falls.  The basic idea of all nonlinear fitting routines is to start with some initial guesses for the fitting parameters, here <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, and by scanning the <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/> landscape, find values of <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> that minimize <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/>.</p>
<p>There are a number of different methods for trying to find the minimum in <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/> for nonlinear fitting problems.  Nevertheless, the method that is most widely used goes by the name of the <em>Levenberg-Marquardt</em> method.  Actually the Levenberg-Marquardt method is a combination of two other methods, the <em>steepest descent</em> (or gradient) method and <em>parabolic extrapolation</em>.  Roughly speaking, when the values of <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> are not too near their optimal values, the gradient descent method determines in which direction in <img class="math" src="../_images/math/e47d270c9b5abe5e041d65ab7a5b0ffe6bb1d284.png" alt="(a,b)"/>-space the function <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/> decreases most quickly&#8212;the direction of steepest descent&#8212;and then changes <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> accordingly to move in that direction.  This method is very efficient unless <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> are very near their optimal values.  Near the optimal values of <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, parabolic extrapolation is more efficient.  Therefore, as  <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> approach their optimal values, the Levenberg-Marquardt method gradually changes to the parabolic extrapolation method, which approximates <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/> by a Taylor series second order in <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/> and <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> and then computes directly the analytical minimum of the Taylor series approximation of <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/>.  This method is only good if the second order Taylor series provides a good approximation of <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/>.  That is why parabolic extrapolation only works well very near the minimum in <img class="math" src="../_images/math/fe6bcd5b8e10d406115af23c155605d3429fc4b4.png" alt="\chi^2(a,b)"/>.</p>
<p>Before illustrating the Levenberg-Marquardt method, we make one important cautionary remark: the Levenberg-Marquardt method can fail if the initial guesses of the fitting parameters are too far away from the desired solution.  This problem becomes more serious the greater the number of fitting parameters.  Thus it is important to provide reasonable initial guesses for the fitting parameters.  Usually, this is not a problem, as it is clear from the physical situation of a particular experiment what reasonable values of the fitting parameters are.  But beware!</p>
<p id="index-5">The <tt class="docutils literal"><span class="pre">scipy.optimize</span></tt> module provides routines that implement the Levenberg-Marquardt non-linear fitting method.  One is called <tt class="docutils literal"><span class="pre">scipy.optimize.leastsq</span></tt>.  A somewhat more user-friendly version of the same method is accessed through another routine in the same <tt class="docutils literal"><span class="pre">scipy.optimize</span></tt> module: it&#8217;s called <tt class="docutils literal"><span class="pre">scipy.optimize.curve_fit</span></tt> and it is the one we demonstrate here.  The function call is</p>
<div class="highlight-python"><div class="highlight"><pre>import scipy.optimize
[... insert code here ...]
scipy.optimize.curve_fit(f, xdata, ydata, p0=None, sigma=None,
                         **kwargs)
</pre></div>
</div>
<p>The arguments of <tt class="docutils literal"><span class="pre">curve_fit</span></tt> are</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">f(xdata,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">...)</span></tt>: is the fitting function where <tt class="docutils literal"><span class="pre">xdata</span></tt> is the data for the independent variable and <tt class="docutils literal"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">...</span></tt> are the fitting parameters, however many there are, listed as separate arguments.  Obviously, <tt class="docutils literal"><span class="pre">f(xdata,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">...)</span></tt> should return the <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> value of the fitting function.</li>
<li><tt class="docutils literal"><span class="pre">xdata</span></tt>: is the array containing the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> data.</li>
<li><tt class="docutils literal"><span class="pre">ydata</span></tt>: is the array containing the <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> data.</li>
<li><tt class="docutils literal"><span class="pre">p0</span></tt>: is a tuple containing the initial guesses for the fitting parameters.  The guesses for the fitting parameters are set equal to 1 if they are left unspecified.  It is almost always a good idea to specify the initial guesses for the fitting parameters.</li>
<li><tt class="docutils literal"><span class="pre">sigma</span></tt>: is the array containing the uncertainties in the <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> data.</li>
<li><tt class="docutils literal"><span class="pre">**kwargs</span></tt>: are keyword arguments that can be passed to the fitting routine <tt class="docutils literal"><span class="pre">scipy.optimize.leastsq</span></tt> that <tt class="docutils literal"><span class="pre">curve_fit</span></tt> calls.  These are usually left unspecified.</li>
</ul>
</div></blockquote>
<p>We demonstrate the use of <tt class="docutils literal"><span class="pre">curve_fit</span></tt> to fit the data plotted in the figure below:</p>
<div class="figure align-center" id="fig-spectrum">
<a class="reference internal image-reference" href="../_images/Spectrum.png"><img alt="Absorption spectrum data." src="../_images/Spectrum.png" style="width: 640.0px; height: 480.0px;" /></a>
</div>
<p>We model the data with the fitting function that consists of a quadratic polynomial background with a Gaussian peak:</p>
<div class="math">
<p><img src="../_images/math/d36e96ab84976d04411f33603bf298c622e1f2c9.png" alt="A(f) = a + bf + cf^2 + P e^{-\frac{1}{2}[(f-f_p)/f_w]^2} ."/></p>
</div><p>Lines 7 and 8 define the fitting functions.  Note that the independent variable <tt class="docutils literal"><span class="pre">f</span></tt> is the first argument, which is followed by the six fitting parameters <img class="math" src="../_images/math/7dd2a5ea01fbd72ad2a58dd1f3d6ecbfde6208a1.png" alt="a"/>, <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/>, <img class="math" src="../_images/math/65868d23a5bfe5b3b2d819386b19c14fa36af134.png" alt="c"/>, <img class="math" src="../_images/math/f48b617185733d8dd6712643f1ab17c736661a06.png" alt="P"/>, <img class="math" src="../_images/math/b34fc6c61e4c9e060e72fb0ab3b2e04fdc15dfaf.png" alt="f_p"/>, and <img class="math" src="../_images/math/60d32479b3b7245c81323a217a11b58d07a1fd85.png" alt="f_w"/>.</p>
<p>To fit the data with <img class="math" src="../_images/math/e4afa2f4314bf665aa16a780c6894d46fab819e4.png" alt="A(f)"/>, we need good estimates of the fitting parameters.  Setting <img class="math" src="../_images/math/72021c179a9de5f6518afa19d6f5489684123f49.png" alt="f=0"/>, we see that <img class="math" src="../_images/math/95146d6099a2a0e0539a275a4ce9dd479ace8c91.png" alt="a \approx 60"/>.  An estimate of the slope of the baseline gives <img class="math" src="../_images/math/0771971a4d6a8e36ee80d7a2e3fe8279828ac7a7.png" alt="b \approx -60/20=-3"/>.  The curvature in the baseline is small so we take <img class="math" src="../_images/math/e1fd7921459711f248550a66235e27d36cf0e555.png" alt="c \approx 0"/>.  The amplitude of the peak above the baseline is <img class="math" src="../_images/math/3e4c1ef7f685f4ce94ec56f8b60253b8022f0d16.png" alt="P \approx 110-30=80"/>.  The peak is centered at <img class="math" src="../_images/math/50650f7aeb08fc154586ae06803f64c9a0c97c26.png" alt="f_p \approx 11"/>, while width of peak is about <img class="math" src="../_images/math/e553db7423c03048b21d9d60d4440c753baa35bd.png" alt="f_w \approx 2"/>.  We use these estimates to set the initial guesses of the fitting parameters in lines 14 and 15 in the code below.</p>
<p id="index-6">The function that performs the Levenverg-Marquardt algorithm, <cite>scipy.optimize.curve_fit</cite>, is called in lines 19-20 with the output set equal to the one and two-dimensional arrays <tt class="docutils literal"><span class="pre">nlfit</span></tt> and <tt class="docutils literal"><span class="pre">nlpcov</span></tt>, respectively.  The array <tt class="docutils literal"><span class="pre">nlfit</span></tt>, which gives the optimal values of the  fitting parameters, is unpacked in line 23.  The square root of the diagonal of the two-dimensional array <tt class="docutils literal"><span class="pre">nlpcov</span></tt>, which gives the estimates of the uncertainties in the fitting parameters, is unpacked in lines 26-27 using a list comprehension.</p>
<p>The rest of the code plots the data, the fitting function using the optimal values of the fitting parameters found by <tt class="docutils literal"><span class="pre">scipy.optimize.curve_fit</span></tt>, and the values of the fitting parameters and their uncertainties.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>  <span class="c"># for unequal plot boxes</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>

<span class="c"># define fitting function</span>
<span class="k">def</span> <span class="nf">GaussPolyBase</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">f</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">f</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">f</span><span class="o">-</span><span class="n">fp</span><span class="p">)</span><span class="o">/</span><span class="n">fw</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># read in spectrum from data file</span>
<span class="c"># f=frequency, s=signal, ds=s uncertainty</span>
<span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&quot;Spectrum.txt&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># initial guesses for fitting parameters</span>
<span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">c0</span> <span class="o">=</span> <span class="mf">60.</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">0.</span>
<span class="n">P0</span><span class="p">,</span> <span class="n">fp0</span><span class="p">,</span> <span class="n">fw0</span> <span class="o">=</span> <span class="mf">80.</span><span class="p">,</span> <span class="mf">11.</span><span class="p">,</span> <span class="mf">2.</span>

<span class="c"># fit data using SciPy&#39;s Levenberg-Marquart method</span>
<span class="n">nlfit</span><span class="p">,</span> <span class="n">nlpcov</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">GaussPolyBase</span><span class="p">,</span>
                <span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">fp0</span><span class="p">,</span> <span class="n">fw0</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">ds</span><span class="p">)</span>

<span class="c"># unpack fitting parameters</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fw</span> <span class="o">=</span> <span class="n">nlfit</span>
<span class="c"># unpack uncertainties in fitting parameters from diagonal</span>
<span class="c"># of covariance matrix</span>
<span class="n">da</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span><span class="p">,</span> <span class="n">dP</span><span class="p">,</span> <span class="n">dfp</span><span class="p">,</span> <span class="n">dfw</span> <span class="o">=</span> \
          <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nlpcov</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlfit</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

<span class="c"># create fitting function from fitted parameters</span>
<span class="n">f_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">25.</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">s_fit</span> <span class="o">=</span> <span class="n">GaussPolyBase</span><span class="p">(</span><span class="n">f_fit</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fw</span><span class="p">)</span>

<span class="c"># Calculate residuals and reduced chi squared</span>
<span class="n">resids</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">GaussPolyBase</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fw</span><span class="p">)</span>
<span class="n">redchisqr</span> <span class="o">=</span> <span class="p">((</span><span class="n">resids</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>

<span class="c"># Create figure window to plot data</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="c"># Top plot: data and fit</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_fit</span><span class="p">,</span> <span class="n">s_fit</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;or&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;frequency (THz)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;absorption (arb units)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s">&#39;a = {0:0.1f}$\pm${1:0.1f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">da</span><span class="p">),</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="s">&#39;b = {0:0.2f}$\pm${1:0.2f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">db</span><span class="p">),</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s">&#39;c = {0:0.2f}$\pm${1:0.2f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">dc</span><span class="p">),</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="s">&#39;P = {0:0.1f}$\pm${1:0.1f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">dP</span><span class="p">),</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="s">&#39;fp = {0:0.1f}$\pm${1:0.1f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dfp</span><span class="p">),</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="s">&#39;fw = {0:0.1f}$\pm${1:0.1f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">dfw</span><span class="p">),</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">,</span> <span class="s">&#39;$\chi_r^2$ = {0:0.2f}&#39;</span>
         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">redchisqr</span><span class="p">),</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;$s(f) = a+bf+cf^2+P\,e^{-(f-f_p)^2/2f_w^2}$&#39;</span><span class="p">)</span>

<span class="c"># Bottom plot: residuals</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&quot;ro&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;frequency (THz)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;residuals&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>The above code also plots the difference between the data and fit, known as the <em>residuals</em> in the subplot below the plot of the data and fit.  Plotting the residuals in this way gives a graphical representation of the goodness of the fit.  To the extent that the residuals vary randomly about zero and do not show any overall upward or downward curvature, or any long wavelength oscillations, the fit would seem to be a good fit.</p>
<div class="figure align-center" id="fig-fitspectrum">
<a class="reference internal image-reference" href="../_images/FitSpectrum.png"><img alt="Fit to power law data using the Levenburg-Marquardt algorithm for nonlinear least squares fitting." src="../_images/FitSpectrum.png" style="width: 640.0px; height: 640.0px;" /></a>
<p class="caption">Fit to Gaussian with quadratic polynomial background.</p>
</div>
<p>Finally, we note that we have used the MatPlotLib package <tt class="docutils literal"><span class="pre">gridspec</span></tt> to create the two subplots with different heights.  The <tt class="docutils literal"><span class="pre">gridspec</span></tt> are made in lines 3 (where the package is imported), 36 (where 2 rows and 1 column are specified with relative heights of 6 to 2), 39 (where the first <tt class="docutils literal"><span class="pre">gs[0]</span></tt> height is specified), and 54 (where the second <tt class="docutils literal"><span class="pre">gs[1]</span></tt> height is specified).  More details about the <tt class="docutils literal"><span class="pre">gridspec</span></tt> package can be found at the MatPlotLib web site.</p>
</div>
<div class="section" id="exercises">
<h2>8.3. Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">When a voltage source is connected across a resistor and inductor in series, the voltage across the inductor <img class="math" src="../_images/math/94a960d3157da7835814f4232743c7d76f05c1c5.png" alt="V_i(t)"/> is predicted to obey the equation</p>
<div class="math" id="equation-eq:inductorDecay">
<p><span class="eqno">(10)</span><img src="../_images/math/202845f110bdda8a66e5649ca2d58f673b8e0d78.png" alt="V(t) = V_0 e^{-\Gamma t}"/></p>
</div><p>where <img class="math" src="../_images/math/ef9270877405055756d345facd044e4ab297f858.png" alt="t"/> is the time and the decay rate <img class="math" src="../_images/math/afffc3699c055a97de990b26932f2622ab4aa6e7.png" alt="\Gamma=R/L"/> is the ratio of the  resistance <img class="math" src="../_images/math/9d86170e7de539c0ff999de09621ee0c7b6c8ed0.png" alt="R"/> to the inductance <img class="math" src="../_images/math/0a5711c7a37994043b2bc3bb374adca232491762.png" alt="L"/> of the circuit.  In this problem, you are to write a Python routine that fits the above equation to the data below for the voltage measured across an inductor after it is connected in series with a resistor to a voltage source.  Following the example in the text, linearize the <a href="#equation-eq:inductorDecay">(10)</a> and use a linear fitting routine, either the one you wrote from the previous chapter or one from NumPy or SciPy.</p>
<ol class="loweralpha">
<li><p class="first">Find the best values of <img class="math" src="../_images/math/85011adca50d3725af2e048eeb9ec7b02ccdd401.png" alt="\Gamma"/> and <img class="math" src="../_images/math/c4a2e0b2a093bd5d2956e9f9279e6605addaeaa9.png" alt="V_0"/> and the uncertainties in their values <img class="math" src="../_images/math/e7e36d8df4f52c2fd4527649132c655bd7ea0029.png" alt="\sigma_\Gamma"/> and <img class="math" src="../_images/math/9899500f1a75978f92d5a75529262e9fe7bc36db.png" alt="\sigma_{V_0}"/>.</p>
</li>
<li><p class="first">Find the value of <img class="math" src="../_images/math/407382c743eb2fdc299a9e2e8dec8863afa187eb.png" alt="\chi_r^2"/> for your fit.  Does it make sense?</p>
</li>
<li><p class="first">Make a semi-log plot of the data using symbols with error bars (no line) and of the fit (line only).  The fit should appear as a straight line that goes through the data points.</p>
</li>
<li><p class="first">If the resistor has a value of 10.0 <img class="math" src="../_images/math/d56cc0fc9f4726624fe7e1ff6a51d696f424416d.png" alt="\mathrm{k}\Omega"/>, what is the value of the inductance and its uncertainty according to your fit, assuming that the error in the resistance is negligibly small.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre>Data for decay of voltage across an inductor
in an RL circuit
Date: 24-Oct-2012
Data taken by D. M. Blantogg and T. P. Chaitor

time (ns)   voltage (volts)  uncertainty (volts)
    0.0        5.08e+00        1.12e-01
   32.8        3.29e+00        9.04e-02
   65.6        2.23e+00        7.43e-02
   98.4        1.48e+00        6.05e-02
  131.2        1.11e+00        5.25e-02
  164.0        6.44e-01        4.00e-02
  196.8        4.76e-01        3.43e-02
  229.6        2.73e-01        2.60e-02
  262.4        1.88e-01        2.16e-02
  295.2        1.41e-01        1.87e-02
  328.0        9.42e-02        1.53e-02
  360.8        7.68e-02        1.38e-02
  393.6        3.22e-02        8.94e-03
  426.4        3.22e-02        8.94e-03
  459.2        1.98e-02        7.01e-03
  492.0        1.98e-02        7.01e-03
</pre></div>
</td></tr></table></div>
</li>
</ol>
</li>
<li><p class="first">Small nanoparticles of soot suspended in water start to aggregate when salt is added.  The average radius <img class="math" src="../_images/math/2ede365ad144ab396916ec60458da03860803078.png" alt="r"/> of the aggregates is predicted to grow as a power law in time <img class="math" src="../_images/math/ef9270877405055756d345facd044e4ab297f858.png" alt="t"/> according to the equation <img class="math" src="../_images/math/3aadd0fd92de3358bf9dac2f3c8b4f8906bcd776.png" alt="r = r_0t^n"/>.  Taking the logarithm of this equation gives <img class="math" src="../_images/math/9faa95337886eb620ff53b66dab292a5368f518e.png" alt="\ln r = n\ln t + \ln r_0"/>.  Thus the data should fall on a straight line if <img class="math" src="../_images/math/f56859678a497bb95a799e17b9d2a237fdc2738d.png" alt="\ln r"/> is plotted <em>vs</em> <img class="math" src="../_images/math/20ac9da0e2724fe8ade2c4cc3fb82ecd24a6f291.png" alt="\ln t"/>.</p>
<ol class="loweralpha">
<li><p class="first">Plot the data below on a graph of <img class="math" src="../_images/math/f56859678a497bb95a799e17b9d2a237fdc2738d.png" alt="\ln r"/> <em>vs</em> <img class="math" src="../_images/math/20ac9da0e2724fe8ade2c4cc3fb82ecd24a6f291.png" alt="\ln t"/> to see if the data fall approximately on a straight line.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre>Size of growing aggregate
Date: 19-Nov-2013
Data taken by M. D. Gryart and M. L. Waites
time (m)   size (nm)    unc (nm)
  0.12        115         10
  0.18        130         12
  0.42        202         14
  0.90        335         18
  2.10        510         20
  6.00        890         30
 18.00       1700         40
 42.00       2600         50
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Defining <img class="math" src="../_images/math/407e1281a8ed48534a3ff6bcb580bc94152dd651.png" alt="y = \ln r"/> and <img class="math" src="../_images/math/19c6740aabbfa1bdc0507646b5e7dcb47e8919e3.png" alt="x = \ln t"/>, use the linear fitting routine you wrote for the previous problem to fit the data and find the optimal values for the slope and <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> intercept, as well as their uncertainties.  Use these fitted values to find the optimal values of the the amplitude <img class="math" src="../_images/math/b0153babd6c8369f8469e7f7ed416c511e3a825a.png" alt="r_0"/> and the power <img class="math" src="../_images/math/413f8a8e40062a9090d9d50b88bc7b551b314c26.png" alt="n"/> in the fitting function <img class="math" src="../_images/math/3aadd0fd92de3358bf9dac2f3c8b4f8906bcd776.png" alt="r = r_0t^n"/>.  What are the fitted values of <img class="math" src="../_images/math/b0153babd6c8369f8469e7f7ed416c511e3a825a.png" alt="r_0"/> and <img class="math" src="../_images/math/413f8a8e40062a9090d9d50b88bc7b551b314c26.png" alt="n"/>?  What is the value of <img class="math" src="../_images/math/407382c743eb2fdc299a9e2e8dec8863afa187eb.png" alt="\chi_r^2"/>?  Does a power law provide an adequate model for the data?</p>
</li>
</ol>
</li>
<li><p class="first">In this problem you explore using a non-linear least square fitting routine to fit the data shown in the figure below.   The data, including the uncertainties in the <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> values, are provided in the table below.  Your task is to fit the function</p>
<div class="math" id="equation-eq:OscDecay">
<p><span class="eqno">(11)</span><img src="../_images/math/3ac9d3e5939efabe7cc876591fde92fa7df29e16.png" alt="d(t) = A (1+B\,\cos\omega t) e^{-t^2/2\tau^2} + C"/></p>
</div><p>to the data, where the fitting parameters are <img class="math" src="../_images/math/0acafa529182e79b4f56165ec677554fba7fcf98.png" alt="A"/>, <img class="math" src="../_images/math/83956e92fcc80dee17fce864543216939a3c9da7.png" alt="B"/>, <img class="math" src="../_images/math/2bcc65482aa8e15cd4c9e9f2542451fb4e971a91.png" alt="C"/>, <img class="math" src="../_images/math/c7415c6919c2eb17b1ea36f0243079b59825ee89.png" alt="\omega"/>, and <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/>.</p>
<div class="figure align-center" id="fig-oscdata">
<a class="reference internal image-reference" href="../_images/DataOscDecay.png"><img alt="../_images/DataOscDecay.png" src="../_images/DataOscDecay.png" style="width: 640.0px; height: 480.0px;" /></a>
</div>
<ol class="loweralpha">
<li><p class="first">Write a Python program that (<em>i</em>) reads the data in from a data file, (<em>ii</em>) defines a function <tt class="docutils literal"><span class="pre">oscDecay(t,</span> <span class="pre">A,</span> <span class="pre">B,</span> <span class="pre">C,</span> <span class="pre">tau,</span> <span class="pre">omega)</span></tt> for the function <img class="math" src="../_images/math/013f8dac7538d1d7a508c910a19cb6c146fd254b.png" alt="d(t)"/> above, and (<em>iii</em>) produces a plot of the data and the function <img class="math" src="../_images/math/013f8dac7538d1d7a508c910a19cb6c146fd254b.png" alt="d(t)"/>.  Choose the fitting parameters  <tt class="docutils literal"><span class="pre">A</span></tt>, <tt class="docutils literal"><span class="pre">B</span></tt>, <tt class="docutils literal"><span class="pre">C</span></tt>, <tt class="docutils literal"><span class="pre">tau</span></tt>, and <tt class="docutils literal"><span class="pre">omega</span></tt> to produce an approximate fit &#8220;by eye&#8221; to the data.  You should be able estimate reasonable values for these parameters just by looking at the data and thinking about the behavior of <img class="math" src="../_images/math/013f8dac7538d1d7a508c910a19cb6c146fd254b.png" alt="d(t)"/>.  For example, <img class="math" src="../_images/math/116559fcbd3fee68dd9e42597e37e5468ace1c15.png" alt="d(0)=A(1+B)+C"/> while <img class="math" src="../_images/math/117cbe0627c7d33bbbeffa3b54118d3237edf561.png" alt="d(\infty)=C"/>.  What parameter in <img class="math" src="../_images/math/013f8dac7538d1d7a508c910a19cb6c146fd254b.png" alt="d(t)"/> controls the period of the peaks observed in the data?  Use that information to estimate the value of that parameter.</p>
</li>
<li><p class="first">Following the example in section <a class="reference internal" href="#sec-nonlinfit"><em>Nonlinear fitting</em></a>, write a program using the SciPy function <tt class="docutils literal"><span class="pre">scipy.optimize.curve_fit</span></tt> to fit Eq. <a href="#equation-eq:OscDecay">(11)</a> to the data and thus find the optimal values of the fitting parameters <img class="math" src="../_images/math/0acafa529182e79b4f56165ec677554fba7fcf98.png" alt="A"/>, <img class="math" src="../_images/math/83956e92fcc80dee17fce864543216939a3c9da7.png" alt="B"/>, <img class="math" src="../_images/math/2bcc65482aa8e15cd4c9e9f2542451fb4e971a91.png" alt="C"/>, <img class="math" src="../_images/math/c7415c6919c2eb17b1ea36f0243079b59825ee89.png" alt="\omega"/>, and <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/>.  Your program should plot the data along with the fitting function using the optimal values of the fitting parameters.  Write a function to calculate the reduced <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/>.  Print out the value of the reduced <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/> on your plot along with the optimal values of the fitting parameters.  You can use the results from part (a) to estimate good starting values of the fitting parameters</p>
</li>
<li><p class="first">Once you have found the optimal fitting parameters, run your fitting program again using for starting values the optimal values of the fitting parameters <img class="math" src="../_images/math/0acafa529182e79b4f56165ec677554fba7fcf98.png" alt="A"/>, <img class="math" src="../_images/math/83956e92fcc80dee17fce864543216939a3c9da7.png" alt="B"/>, <img class="math" src="../_images/math/2bcc65482aa8e15cd4c9e9f2542451fb4e971a91.png" alt="C"/>, and <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/>, but set the starting value of <img class="math" src="../_images/math/c7415c6919c2eb17b1ea36f0243079b59825ee89.png" alt="\omega"/> to be 3 times the optimal value.  You should find that the program converges to a different set of fitting parameters than the ones you found in part (b).  Using the program you wrote for part (b) make a plot of the data and the fit like the one you did for part (a).  The fit should be noticeably worse.  What is the value of the reduced <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/> for this fit; it should be much larger than the one you found for part (c).  The program  has found a local minimum in <img class="math" src="../_images/math/8bd0685e3bf9101859d24cf0e851651f182364c9.png" alt="\chi^2"/>&#8212;one that is obviously is not the best fit!</p>
</li>
<li><p class="first">Setting the fitting parameters <img class="math" src="../_images/math/0acafa529182e79b4f56165ec677554fba7fcf98.png" alt="A"/>, <img class="math" src="../_images/math/83956e92fcc80dee17fce864543216939a3c9da7.png" alt="B"/>, <img class="math" src="../_images/math/2bcc65482aa8e15cd4c9e9f2542451fb4e971a91.png" alt="C"/>, and <img class="math" src="../_images/math/d9e99c35d3632bb156b7aca0e93cd78a148a10e8.png" alt="\tau"/> to the optimal values you found in part (b), plot <img class="math" src="../_images/math/407382c743eb2fdc299a9e2e8dec8863afa187eb.png" alt="\chi_r^2"/> as a function of <img class="math" src="../_images/math/c7415c6919c2eb17b1ea36f0243079b59825ee89.png" alt="\omega"/> for <img class="math" src="../_images/math/c7415c6919c2eb17b1ea36f0243079b59825ee89.png" alt="\omega"/> spanning the range from 0.05 to 3.95.  You should observe several local minima for different values of <img class="math" src="../_images/math/407382c743eb2fdc299a9e2e8dec8863afa187eb.png" alt="\chi_r^2"/>; the global minimum in <img class="math" src="../_images/math/407382c743eb2fdc299a9e2e8dec8863afa187eb.png" alt="\chi_r^2"/> should occur for the optimal value of <img class="math" src="../_images/math/c7415c6919c2eb17b1ea36f0243079b59825ee89.png" alt="\omega"/> you found in part (b).</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre>Data for absorption spectrum
Date: 21-Nov-2012
Data taken by P. Dubson and M. Sparks
time (ms)  signal  uncertainty
  0.2      41.1       0.9
  1.4      37.2       0.9
  2.7      28.3       0.9
  3.9      24.8       1.1
  5.1      27.8       0.8
  6.4      34.5       0.7
  7.6      39.0       0.9
  8.8      37.7       0.8
 10.1      29.8       0.9
 11.3      22.2       0.7
 12.5      22.3       0.6
 13.8      26.7       1.1
 15.0      30.4       0.7
 16.2      32.6       0.8
 17.5      28.9       0.8
 18.7      22.9       1.3
 19.9      21.7       0.9
 21.1      22.1       1.0
 22.4      22.3       1.0
 23.6      26.3       1.0
 24.8      26.2       0.8
 26.1      21.4       0.9
 27.3      20.0       1.0
 28.5      20.1       1.2
 29.8      21.2       0.5
 31.0      22.0       0.9
 32.2      21.6       0.7
 33.5      21.0       0.7
 34.7      19.7       0.9
 35.9      17.9       0.9
 37.2      18.1       0.8
 38.4      18.9       1.1
</pre></div>
</td></tr></table></div>
</li>
</ol>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../chap1/chap1_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap2/chap2_basics.html">2. Launching Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap3/chap3_arrays.html">3. Strings, Lists, Arrays, and Dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap4/chap4_io.html">4. Input and Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap5/chap5_plot.html">5. Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap6/chap6_loopsconds.html">6. Conditionals and Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chap7/chap7_funcs.html">7. Functions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">8. Curve Fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-linear-regression-for-fitting-non-linear-functions">8.1. Using linear regression for fitting non-linear functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nonlinear-fitting">8.2. Nonlinear fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">8.3. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chap9/chap9_scipy.html">9. Numerical Routines: SciPy and NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apdx1/apdx1_install.html">10. Installing Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apdx2/apdx2_ipynb.html">11. IPython Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apdx3/apdx3_resources.html">12. Python Resources</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../chap7/chap7_funcs.html" title="7. Functions"
             >previous</a> |
          <a href="../chap9/chap9_scipy.html" title="9. Numerical Routines: SciPy and NumPy"
             >next</a> |
          <a href="../genindex.html" title="General Index"
             >index</a>
            <br/>
            <a href="../_sources/chap8/chap8_fitting.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2014, David J. Pine.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>